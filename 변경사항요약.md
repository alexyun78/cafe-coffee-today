# 오늘의 커피 웹앱 수정 사항

## 수정 완료된 3가지 문제

### 1. 중복된 데이터 처리 개선 ✅
**문제**: 노션에 중복된 커피 데이터가 있을 경우 처리 방식이 불명확했습니다.

**해결**: 
- 중복된 커피 이름이 있어도 각각을 **개별적으로 표시**합니다.
- **로스팅 일자가 최신인 순서**로 정렬하여 보여줍니다.
- 같은 커피라도 로스팅 날짜가 다르면 별도의 항목으로 표시됩니다.

**코드 변경** (`app.py`):
```python
# 정렬: 로스팅일 최신순 (중복 데이터는 개별적으로 표시)
def sort_key(item):
    roast_obj = item.get("로스팅")
    roast_date = parse_date(roast_obj)
    roast_time = roast_date.timestamp() if roast_date else 0
    return -roast_time

all_coffee.sort(key=sort_key)
```

---

### 2. 제공일 표시 개선 (시작일 ~ 종료일) ✅
**문제**: 제공일에 시작일과 종료일이 있는데 종료일이 표시되지 않았습니다.

**해결**:
- 제공일에 **종료일이 있으면** "11/15 ~ 11/20" 형식으로 표시
- 제공일에 **종료일이 없으면** "11/15" 형식으로 표시
- 종료일이 없어도 에러가 발생하지 않도록 안전하게 처리

**코드 변경** (`index.html`):
```javascript
function formatDateShort(dateObj) {
    if (!dateObj) return '-';
    const start = dateObj.start;
    const end = dateObj.end;
    
    if (!start) return '-';
    
    const startDate = new Date(start);
    const startStr = `${startDate.getMonth() + 1}/${startDate.getDate()}`;
    
    if (end) {
        const endDate = new Date(end);
        const endStr = `${endDate.getMonth() + 1}/${endDate.getDate()}`;
        return `${startStr} ~ ${endStr}`;
    }
    
    return startStr;
}
```

---

### 3. 커피 히스토리 필터링 (최근 한 달) ✅
**문제**: 커피 히스토리에 모든 데이터가 표시되어 오래된 데이터도 함께 보였습니다.

**해결**:
- **오늘 날짜 기준으로 로스팅 한 달(30일) 이내** 데이터만 표시
- 로스팅 날짜가 없는 데이터도 포함 (안전성)
- 최신 로스팅 데이터부터 정렬하여 표시

**코드 변경** (`app.py`):
```python
# 오늘 날짜 기준 한 달 전 계산
from datetime import timedelta
now = datetime.now()
one_month_ago = now - timedelta(days=30)

# 로스팅 날짜 확인
roast_date = parse_date(coffee_data.get("로스팅"))

# 히스토리는 로스팅 한 달 이내 데이터만 포함
if roast_date and roast_date >= one_month_ago:
    all_coffee.append(coffee_data)
elif not roast_date:
    # 로스팅 날짜가 없는 경우도 포함
    all_coffee.append(coffee_data)
```

---

## 수정된 파일

1. **app.py** - Flask 백엔드
   - 로스팅 한 달 이내 필터링 추가
   - 로스팅 일자 최신순 정렬로 변경
   - 로스터리 필드 추가

2. **index.html** - 프론트엔드
   - `formatDateShort` 함수 개선 (종료일 표시)

---

## 테스트 방법

1. 로컬 환경에서 테스트:
   ```bash
   python app.py
   ```

2. 브라우저에서 확인:
   - http://localhost:5000

3. 확인 사항:
   - ✅ 히스토리에 최근 한 달 데이터만 표시되는지
   - ✅ 중복된 커피가 개별적으로 표시되는지
   - ✅ 제공일에 종료일이 있으면 "시작일 ~ 종료일" 형식으로 표시되는지

---

## 배포 방법

기존과 동일하게 Render 또는 GitHub Pages에 배포하시면 됩니다.

자세한 배포 방법은 프로젝트의 다음 문서를 참고하세요:
- `RENDER_DEPLOY.md` - Render 배포 가이드
- `deploy_to_github.sh` 또는 `deploy_to_github.bat` - GitHub Pages 배포 스크립트