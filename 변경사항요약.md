# 오늘의 커피 웹앱 최종 수정 사항

## 수정 완료된 6가지 기능

### 1. 중복된 데이터 처리 개선 ✅
**문제**: 노션에 중복된 커피 데이터가 있을 경우 처리 방식이 불명확했습니다.

**해결**: 
- 중복된 커피 이름이 있어도 각각을 **개별적으로 표시**합니다.
- **로스팅 일자가 최신인 순서**로 정렬하여 보여줍니다.
- 같은 커피라도 로스팅 날짜가 다르면 별도의 항목으로 표시됩니다.

---

### 2. 제공일 표시 개선 (시작일 ~ 종료일) ✅
**문제**: 제공일에 시작일과 종료일이 있는데 종료일이 표시되지 않았습니다.

**해결**:
- 제공일에 **종료일이 있으면** "11/15 ~ 11/20" 형식으로 표시
- 제공일에 **종료일이 없으면** "11/15" 형식으로 표시
- 종료일이 없어도 에러가 발생하지 않도록 안전하게 처리

---

### 3. 커피 히스토리 필터링 (최근 한 달) ✅
**문제**: 커피 히스토리에 모든 데이터가 표시되어 오래된 데이터도 함께 보였습니다.

**해결**:
- **오늘 날짜 기준으로 로스팅 한 달(30일) 이내** 데이터만 표시
- 로스팅 날짜가 없는 데이터도 포함 (안전성)
- 최신 로스팅 데이터부터 정렬하여 표시

---

### 4. 커피 히스토리 테이블 컬럼 변경 ✅
**문제**: 커피 히스토리에서 로스터리 대신 컵노트를 표시하는 것이 더 유용합니다.

**해결**:
- 커피 히스토리 테이블에서 **"로스터리" 컬럼을 제거**하고 **"컵노트" 컬럼 추가**
- 데스크톱 테이블과 모바일 카드 모두에 적용

**수정된 테이블 헤더**:
```
커피 | 프로세싱 | 상태 | 컵노트 | 로스팅 | 제공일
```

---

### 5. "예정" 상태 우선 정렬 ✅
**문제**: 상태값 "예정"을 추가했는데 특별한 정렬이 필요합니다.

**해결**:
- 커피 히스토리에서 **상태가 "예정"인 커피를 최상단에 표시**
- "예정" 상태 커피들 사이에서는 **로스팅 날짜 최신순** 정렬
- 그 이후는 기존과 동일하게 로스팅 날짜 최신순 정렬

**정렬 우선순위**:
1. 상태 "예정" (최우선)
2. 로스팅 날짜 최신순

**코드 변경** (`app.py`):
```python
# 정렬: 상태 "예정" 최우선 -> 로스팅일 최신순
def sort_key(item):
    # 상태가 "예정"인 경우 최우선 (0)
    status = item.get("상태")
    status_priority = 0 if status == "예정" else 1
    
    # 로스팅일
    roast_obj = item.get("로스팅")
    roast_date = parse_date(roast_obj)
    roast_time = roast_date.timestamp() if roast_date else 0
    
    return (status_priority, -roast_time)
```

**스타일 추가** (`index.html`):
```css
.badge-예정 { background: #E1F5FE; color: #0277BD; }
```

---

### 6. 커피 히스토리 클릭 시 상세 팝업 ✅
**문제**: 커피 히스토리에서 감상평을 바로 확인할 수 없었습니다.

**해결**:
- 커피 히스토리의 **테이블 행 또는 카드를 클릭**하면 **모달 팝업**이 표시됩니다
- 팝업에서 **컵노트, 감상평** 등 상세 정보를 확인할 수 있습니다
- 데스크톱과 모바일 모두에서 동작합니다

**팝업 표시 항목**:
- 커피 이름 (제목)
- 프로세싱
- 상태
- 로스팅 날짜
- 제공일
- 컵노트
- 감상 (감상평)

**주요 기능**:
- 행/카드 클릭 시 팝업 열기
- X 버튼 클릭 또는 팝업 외부 클릭 시 닫기
- 부드러운 애니메이션 효과
- 호버 시 커서 변경 및 배경색 변화

**코드 변경** (`index.html`):
```javascript
// 모달 팝업 열기
function openCoffeeModal(coffee) {
    // 커피 상세 정보를 모달에 표시
}

// 모달 팝업 닫기
function closeCoffeeModal() {
    modal.style.display = 'none';
}

// 테이블 행에 클릭 이벤트 추가
<tr onclick="openCoffeeModal(window.coffeeHistory[${index}])">

// 모바일 카드에 클릭 이벤트 추가
<div class="history-card" onclick="openCoffeeModal(window.coffeeHistory[${index}])">
```

---

## 수정된 파일

1. **app.py** - Flask 백엔드
   - 로스팅 한 달 이내 필터링 추가
   - 상태 "예정" 최우선 정렬 로직 추가
   - 로스팅 일자 최신순 정렬
   - 로스터리 필드 추가

2. **index.html** - 프론트엔드
   - `formatDateShort` 함수 개선 (종료일 표시)
   - 커피 히스토리 테이블: 로스터리 → 컵노트로 변경
   - 모바일 카드: 로스터리 → 컵노트로 변경
   - 상태 "예정" 뱃지 스타일 추가
   - 모달 팝업 CSS 스타일 추가
   - 모달 팝업 JavaScript 함수 추가
   - 히스토리 클릭 이벤트 추가

---

## 사용 방법

### 커피 상세 정보 확인하기
1. 커피 히스토리 섹션에서 원하는 커피 행(데스크톱) 또는 카드(모바일)를 클릭합니다
2. 팝업이 표시되면 컵노트, 감상평 등을 확인할 수 있습니다
3. X 버튼 또는 팝업 외부를 클릭하여 닫습니다

### 상태별 확인
- **예정**: 아직 제공되지 않은 커피 (최상단 표시)
- **진행 중**: 현재 제공 중인 커피
- **시작 전**: 준비 중인 커피
- **완료**: 제공이 완료된 커피

---

## 테스트 방법

1. 로컬 환경에서 테스트:
   ```bash
   python app.py
   ```

2. 브라우저에서 확인:
   - http://localhost:5000

3. 확인 사항:
   - ✅ 히스토리에 최근 한 달 데이터만 표시되는지
   - ✅ 중복된 커피가 개별적으로 표시되는지
   - ✅ 제공일에 종료일이 있으면 "시작일 ~ 종료일" 형식으로 표시되는지
   - ✅ 커피 히스토리에서 로스터리 대신 컵노트가 표시되는지
   - ✅ 상태가 "예정"인 커피가 최상단에 표시되는지
   - ✅ 히스토리를 클릭하면 상세 팝업이 나타나는지
   - ✅ 팝업에서 감상평을 확인할 수 있는지

---

## 배포 방법

기존과 동일하게 Render 또는 GitHub Pages에 배포하시면 됩니다.

자세한 배포 방법은 프로젝트의 다음 문서를 참고하세요:
- `RENDER_DEPLOY.md` - Render 배포 가이드
- `deploy_to_github.sh` 또는 `deploy_to_github.bat` - GitHub Pages 배포 스크립트

---

## 주요 개선 사항 요약

| 기능 | 설명 |
|------|------|
| 중복 데이터 처리 | 개별 표시, 로스팅 날짜 최신순 정렬 |
| 제공일 표시 | 시작일 ~ 종료일 형식 지원 |
| 데이터 필터링 | 로스팅 한 달 이내만 표시 |
| 테이블 컬럼 | 로스터리 → 컵노트로 변경 |
| 예정 상태 | 최우선 정렬로 표시 |
| 상세 팝업 | 클릭 시 감상평 등 상세 정보 표시 |

이제 더욱 직관적이고 사용하기 편리한 커피 정보 시스템이 되었습니다!